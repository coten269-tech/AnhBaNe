<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload ·∫£nh l√™n ImageBoss</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
      background: linear-gradient(270deg, #ff7a7a, #ffb36b, #fff38a, #9be89b, #7fb6ff, #b58bff);
      background-size: 1400% 1400%;
      animation: bg 18s linear infinite;
    }
    @keyframes bg {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
    video, img {
      width: 300px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
    }
    button {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }
    #status { margin-top: 15px; font-weight: bold; }
    #link { margin-top: 10px; }
  </style>
</head>
<body>

  <h2>üì∏ Ch·ª•p v√† g·ª≠i ·∫£nh l√™n ImageBoss</h2>
  <button id="startBtn">M·ªü Camera</button>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="preview" alt="·∫¢nh ch·ª•p" />
  <div>
    <button id="captureBtn" style="display:none;">Ch·ª•p v√† G·ª≠i</button>
  </div>
  <div id="status"></div>
  <div id="link"></div>

  <script>
    const API_KEY = "f26fc472fa908c6a4c09c5d7b838502e4026472ad7e6ada1fb992abe2663c4"; // ‚ö†Ô∏è Demo key
    const SOURCE = "img.imageboss.me"; // ngu·ªìn c·ªßa b·∫°n (thay n·∫øu kh√°c)

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const preview = document.getElementById("preview");
    const statusDiv = document.getElementById("status");
    const linkDiv = document.getElementById("link");
    const startBtn = document.getElementById("startBtn");
    const captureBtn = document.getElementById("captureBtn");
    let stream;

    startBtn.onclick = async () => {
      stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
      video.style.display = "block";
      captureBtn.style.display = "inline-block";
      statusDiv.textContent = "Camera ƒë√£ b·∫≠t ‚úÖ";
    };

    captureBtn.onclick = async () => {
      const ctx = canvas.getContext("2d");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const dataURL = canvas.toDataURL("image/png");
      preview.src = dataURL;
      preview.style.display = "block";
      statusDiv.textContent = "‚è≥ ƒêang t·∫£i ·∫£nh l√™n ImageBoss...";

      const blob = await (await fetch(dataURL)).blob();
      const formData = new FormData();
      formData.append("file", blob, "photo.png");

      // G·ª≠i ·∫£nh
      const uploadURL = `https://${SOURCE}/upload?key=${API_KEY}`;
      try {
        const res = await fetch(uploadURL, {
          method: "POST",
          body: formData
        });

        const result = await res.json();
        if (result && result.url) {
          statusDiv.textContent = "‚úÖ ·∫¢nh ƒë√£ ƒë∆∞·ª£c t·∫£i l√™n th√†nh c√¥ng!";
          linkDiv.innerHTML = `<a href="${result.url}" target="_blank">${result.url}</a>`;
        } else {
          throw new Error("Upload th·∫•t b·∫°i!");
        }
      } catch (e) {
        statusDiv.textContent = "‚ùå L·ªói: " + e.message;
      } finally {
        stream.getTracks().forEach(track => track.stop());
        video.style.display = "none";
        captureBtn.style.display = "none";
      }
    };
  </script>
</body>
</html>
