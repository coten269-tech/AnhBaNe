<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Kiểm tra tên thật</title>
  <style>
    body {
      background: linear-gradient(270deg, red, orange, yellow, green, blue, indigo, violet);
      background-size: 1200% 1200%;
      animation: move 10s linear infinite;
      font-family: Arial, sans-serif;
      display: flex; justify-content: center; align-items: center;
      height: 100vh;
    }
    @keyframes move { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    form {
      background: white;
      padding: 25px;
      border-radius: 15px;
      width: 340px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      border: 2px solid #ccc;
      font-size: 16px;
    }
    input.invalid { border-color: red; background: #ffeaea; }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .error { color: red; font-size: 14px; margin-top: 8px; display:none; }
    .success { color: green; font-weight: bold; margin-top: 8px; display:none; }
  </style>
</head>
<body>
  <form id="nameForm" method="POST" action="https://formspree.io/f/mwprbgra">
    <h2>Nhập tên của bạn</h2>
    <input type="text" id="name" name="name" placeholder="Ví dụ: Nguyễn Hải Đăng" required>
    <div id="error" class="error"></div>
    <button type="submit">Gửi</button>
    <div id="success" class="success">✅ Gửi thành công!</div>
  </form>

  <script>
    const hoPhoBien = ["nguyễn","trần","lê","phạm","hoàng","đặng","bùi","đỗ","vũ","võ","phan","ngô","dương","hồ"];
    const tenPhoBien = ["anh","bình","hạnh","đăng","đức","tuấn","minh","huy","long","linh","phương","quang","thắng","thanh","hải","sơn","tài","ngọc","tú","vân"];
    const nguyAm = "aeiouyàáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹ";
    
    function removeAccents(str){ return str.normalize("NFD").replace(/[\u0300-\u036f]/g, ""); }
    
    function entropy(str){
      const freq = {};
      for(let c of str) freq[c] = (freq[c]||0)+1;
      let e=0; for(let c in freq){ const p=freq[c]/str.length; e-=p*Math.log2(p); }
      return e;
    }

    function isLikelyVietnameseName(name){
      if(!name) return {ok:false, reason:"Tên trống"};
      name = name.trim().replace(/\s+/g, " ");
      const words = name.split(" ");
      if(words.length < 1 || words.length > 4) return {ok:false, reason:"Tên phải có 1–4 từ"};
      if(name.length < 3 || name.length > 40) return {ok:false, reason:"Độ dài không hợp lệ"};

      // chỉ chữ
      if(!/^[\p{L}\s]+$/u.test(name)) return {ok:false, reason:"Tên chỉ được chứa chữ cái"};

      // entropy
      if(entropy(name.replace(/\s+/g,'')) > 4.5) return {ok:false, reason:"Tên trông như chuỗi ngẫu nhiên"};

      // nguyên âm mỗi từ
      for(let w of words){
        if(![...w.toLowerCase()].some(c => nguyAm.includes(c)))
          return {ok:false, reason:`Từ '${w}' không có nguyên âm`};
      }

      // kiểm tra tên phổ biến
      const noAccent = removeAccents(name.toLowerCase());
      const hasHo = hoPhoBien.some(h => noAccent.includes(h));
      const hasTen = tenPhoBien.some(t => noAccent.includes(t));
      if(!hasHo && !hasTen)
        return {ok:false, reason:"Không có họ hoặc tên phổ biến"};

      // không lặp lại từ nhiều lần
      const lowerWords = words.map(w=>w.toLowerCase());
      const set = new Set(lowerWords);
      if(set.size < lowerWords.length - 1)
        return {ok:false, reason:"Tên có từ bị lặp lại"};

      return {ok:true, cleaned: name};
    }

    function titleCaseVN(str){
      return str.split(' ').map(w => w.charAt(0).toUpperCase()+w.slice(1).toLowerCase()).join(' ');
    }

    const form = document.getElementById("nameForm");
    const nameInput = document.getElementById("name");
    const errorDiv = document.getElementById("error");
    const successDiv = document.getElementById("success");

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      successDiv.style.display = "none";
      const name = titleCaseVN(nameInput.value);
      nameInput.value = name;
      const check = isLikelyVietnameseName(name);
      if(!check.ok){
        errorDiv.textContent = "❌ " + check.reason;
        errorDiv.style.display = "block";
        nameInput.classList.add("invalid");
        return;
      }
      errorDiv.style.display = "none";
      nameInput.classList.remove("invalid");

      // Gửi đến Formspree
      try {
        const res = await fetch(form.action, {
          method: "POST",
          headers: { "Accept":"application/json","Content-Type":"application/json" },
          body: JSON.stringify({ name })
        });
        if(res.ok){
          successDiv.style.display = "block";
          nameInput.value = "";
        } else {
          errorDiv.textContent = "❌ Lỗi gửi dữ liệu!";
          errorDiv.style.display = "block";
        }
      } catch {
        errorDiv.textContent = "❌ Mất kết nối!";
        errorDiv.style.display = "block";
      }
    });
  </script>
</body>
</html>
